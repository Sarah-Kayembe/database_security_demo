{% extends "base.html" %}
{% block content %}

<h2>ğŸ” LEVEL 2 â€” Search Injection</h2>

<div class="ascii-box">
    The marketplace lies before youâ€¦  
    But only forbidden queries awaken its secrets.
</div>

<form method="GET" action="/search">
    <p>Search term:</p>
    <input name="s" value="{{ term }}">
    <button type="submit">Search</button>
</form>

{% if error %}
<p style="color:red;">SQL Error: {{ error }}</p>
{% endif %}

{% if term %}
<hr>

<h3>Market Response:</h3>

{% if results %}
    {% for row in results %}
        <div>[{{ row.id }}] {{ row.name }} â€” {{ row.description }}</div>
    {% endfor %}
{% else %}

    <div class="ascii-box" style="color:#ff6;">
    {% if dangerous %}
        <strong>You have disturbed the codeâ€¦</strong><br>
        Your injection rattles the marketplace,<br>
        but your technique is too weak to reveal its secrets, mere mortal!<br><br>

        <em>â€œThe gatekeeper whispers:â€</em><br>
        <span style="color:#0f0;">
            â€œTry again, wanderer. True UNION magic is needed  
            if you want me to surrender my knowledge.â€
        </span>
    {% else %}
        (What is that? Brother ewww! That which you seek cannot be found here! Be gone!)
    {% endif %}
    </div>

{% endif %}
{% endif %}

{% if dangerous %}
<hr>

{# ----------------------------------------------- #}
{# NEW BLOCK â†’ If the secret word was already taken #}
{# ----------------------------------------------- #}

{% if already_claimed %}
<div class="ascii-box" style="color:#f88;">
    <strong>The chamber echoes faintlyâ€¦</strong><br>
    â€œYou have already extracted the secret hidden here.<br>
    This place has nothing more to offer you. Away with you, quench your GREED!â€  
</div>

<p style="color:#0f0; margin-top:15px;">
    You may <a href="/clue2">proceed to Clue #2</a> when ready.
</p>

{% else %}

{# EXISTING BLOCK â†’ Secret Word is available #}

{% if session.last_secret_word %}
<div class="ascii-box">
    <strong>Secret Word Earned:</strong> {{ session.last_secret_word }}<br><br>

    <span style="color:#0f0;">
        â€œA fragment of the ancient sentence has been revealedâ€¦  
        Guard it well.â€
    </span>
</div>
{% endif %}

<p style="color:#0f0; margin-top:15px;">
    You may <a href="/clue2">proceed to Clue #2</a>â€¦<br>
    But beware â€” advancing without unlocking the secret word 
    in this stage may lead you to a path of certain doom!
</p>

{% endif %}
{% endif %}

{% endblock %}
